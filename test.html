<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sort tests</title>
  <link rel="stylesheet" href="https://test.mavo.io/style.css" />
  <link rel="stylesheet" href="https://get.mavo.io/mavo.css" />
  <script src="https://dev.mavo.io/dist/mavo.js"></script>
</head>
<body>

<h1>Sort tests</h1>

<button id="checkAndSave" style="font-size: 200%">Check all checkboxes and save
all Mavos</button>

<section>
	<h1>String and number sorts, expected use cases</h1>
	<table class="reftest" data-test="expressionEvaluation" data-columns="3">

		<!--Sort on empty array-->
		<tr title="Empty array">
			<td>sort([])</td>
			<td>[]</td>
		</tr>

		<!--Sort on numbers-->
		<tr title="Numbers">
			<td>sort([9, 4, 3, 5, 1, 2, 6, 0, 8, 7])</td>
			<td>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</td>
		</tr>

		<!--Sort on numbers with negative values-->
		<tr title="Mixed sign numbers">
			<td>sort([-10, 5, 3, -3, 10,  -2, 1, -7, 9, 7])</td>
			<td>[-10, -7, -3, -2, 1, 3, 5, 7, 9, 10]</td>
		</tr>

		<!--Sort on simple strings-->
		<tr title="Simple strings">
			<td>sort(['g', 'r', 'w', 'i', 's', 'a', 'h', 'o'])</td>
			<td>['a', 'g', 'h', 'i', 'o', 'r', 's', 'w']</td>
		</tr>

		<!--Sort on strings-->
		<tr title="Strings">
			<td>sort(['zaa', 'bcde', 'abc', 'bcda', 'bcd', 'aeb', 'abe', 'abcd'])</td>
			<td>['abc', 'abcd', 'abe', 'aeb', 'bcd', 'bcda', 'bcde', 'zaa']</td>
		</tr>

		<!--Sort on numbers with negative values, specifying +-->
		<tr title="Mixed sign numbers, + order specified">
			<td>sort([-10, 5, 3, -3, 10,  -2, 1, -7, 9, 7], '+')</td>
			<td>[-10, -7, -3, -2, 1, 3, 5, 7, 9, 10]</td>
		</tr>

		<!--Sort on strings, specifying +-->
		<tr title="Strings, + order specified">
			<td>sort(['zaa', 'bcde', 'abc', 'bcda', 'bcd', 'aeb', 'abe', 'abcd'], '+')</td>
			<td>['abc', 'abcd', 'abe', 'aeb', 'bcd', 'bcda', 'bcde', 'zaa']</td>
		</tr>

		<!--Reverse sort on numbers-->
		<tr title="Mixed sign numbers, - order specified">
			<td>sort([-3, 2, -4, 1, 0, -2, -5, 5, 4, 3, -1], '-')</td>
			<td>[5, 4, 3, 2, 1, 0, -1, -2, -3, -4, -5]</td>
		</tr>

		<!--Reverse sort on strings-->
		<tr title="Strings, - order specified">
			<td>sort(['mnoz', 'zabc', 'za', 'b', 'z', 'zabcd', 'zab', 'a', 'mnoa', 'c', 'mnom'], '-')</td>
			<td>['zabcd', 'zabc', 'zab', 'za', 'z', 'mnoz', 'mnom', 'mnoa', 'c', 'b', 'a']</td>
		</tr>

	</table>
</section>

<section>
	<h1>String and number sorts, unexpected use cases</h1>
	<table class="reftest" data-test="expressionEvaluation" data-columns="3">
		<!--Sort with invalid order param-->
		<!--TODO: go with default sort? Have sort fail?-->
		<tr title="Invalid order param">
			<td>sort(['zaa', 'bcde', 'abc', 'bcda', 'bcd', 'aeb', 'abe', 'abcd'], 'blah')</td>
			<td>['abc', 'abcd', 'abe', 'aeb', 'bcd', 'bcda', 'bcde', 'zaa']</td>
		</tr>

		<!--Sort with invalid order param, but valid order param later-->
		<!--TODO: go with first param that makes sense?-->
		<tr title="Invalid order param, but valid order param later">
			<td>sort(['zaa', 'bcde', 'abc', 'bcda', 'bcd', 'aeb', 'abe', 'abcd'], 'blah', '-')</td>
			<td>['zaa', 'bcde', 'bcda', 'bcd', 'aeb', 'abe', 'abcd', 'abc']</td>
		</tr>
		<!--Sort with invalid order param where property doesn't exist, but looks like they want decrease-->
		<!-- TODO: go with decrease? Stick with default sort (increase)? Have sort fail? -->
		<tr title="Invalid order param with order specified">
			<td>sort(['zaa', 'bcde', 'abc', 'bcda', 'bcd', 'aeb', 'abe', 'abcd'], '-blah')</td>
			<td>['abc', 'abcd', 'abe', 'aeb', 'bcd', 'bcda', 'bcde', 'zaa']</td>
		</tr>
		<!--TODO: same thing? even though + is in blah?-->
		<tr title="Invalid order param with order specified, valid order param later">
			<td>sort(['zaa', 'bcde', 'abc', 'bcda', 'bcd', 'aeb', 'abe', 'abcd'], '+blah', '-')</td>
			<td>['zaa', 'bcde', 'bcda', 'bcd', 'aeb', 'abe', 'abcd', 'abc']</td>
		</tr>


		<!--Sort on numbers with int order param-->
		<!--TODO: Use sign of number as sort criteria?-->
		<tr title="Number as order param">
			<td>sort([-3, 2, -4, 1, 0, -2, -5, 5, 4, 3, -1], -1)</td>
			<td>[5, 4, 3, 2, 1, 0, -1, -2, -3, -4, -5]</td>
		</tr>
		<tr>
			<td>sort([-3, 2, -4, 1, 0, -2, -5, 5, 4, 3, -1], 0)</td>
			<td>[-5,- 4, -3, -2, -1, 0, 1, 2, 3, 4, 5]</td>
		</tr>
		<tr>
			<td>sort([-3, 2, -4, 1, 0, -2, -5, 5, 4, 3, -1], 1)</td>
			<td>[-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5]</td>
		</tr>
	</table>
</section>

<section>
	<h1>Object sort, expected use cases</h1>

	<table class="reftest" data-test="expressionEvaluation" data-columns="3">

		<tr title="Simple objects, no property">
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			])</td>
			<td>[
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			]</td>
		</tr>

		<tr title="Simple objects, property no order">
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			], "prop1")</td>
			<td>[
				{"prop1": "c", "prop2": 1},
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
			]</td>
		</tr>
		<tr>
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			], "prop2")</td>
			<td>[
				{"prop1": "a", "prop2": 3},
				{"prop1": "b", "prop2": 2},
				{"prop1": "c", "prop2": 1},
			]</td>
		</tr>

		<tr title="Simple objects, property inc order">
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			], "+prop1")</td>
			<td>[
				{"prop1": "a", "prop2": 3},
				{"prop1": "b", "prop2": 2},
				{"prop1": "c", "prop2": 1},
			]</td>
		</tr>
		<tr>
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			], "+prop2")</td>
			<td>[
				{"prop1": "c", "prop2": 1},
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
			]</td>
		</tr>

		<tr title="Simple objects, property dec order">
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			], "-prop1")</td>
			<td>[
				{"prop1": "c", "prop2": 1},
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
			]</td>
		</tr>
		<tr>
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 3},
				{"prop1": "c", "prop2": 1},
			], "-prop2")</td>
			<td>[
				{"prop1": "a", "prop2": 3},
				{"prop1": "b", "prop2": 2},
				{"prop1": "c", "prop2": 1},
			]</td>
		</tr>

		<tr title="Simple objects, multiple properties">
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 2},
				{"prop1": "c", "prop2": 1},
				{"prop1": "d", "prop2": 1},
			], "+prop2", "-prop1")</td>
			<td>[
				{"prop1": "d", "prop2": 1},
				{"prop1": "c", "prop2": 1},
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 2},
			]</td>
		</tr>
		<tr>
			<td>sort([
				{"prop1": "b", "prop2": 2},
				{"prop1": "a", "prop2": 2},
				{"prop1": "c", "prop2": 1},
				{"prop1": "d", "prop2": 1},
			], "-prop2", "+prop1")</td>
			<td>[
				{"prop1": "a", "prop2": 2},
				{"prop1": "b", "prop2": 2},
				{"prop1": "c", "prop2": 1},
				{"prop1": "d", "prop2": 1},
			]</td>
		</tr>

		<tr title="Deep objects, single property">
			<td>sort([
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
			], "+prop11.prop21.prop33")</td>
			<td>[
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
			]</td>
		</tr>

		<tr title="Deep objects, multiple properties">
			<td>sort([
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
			], "prop11.prop21.prop32", "-prop11.prop22")</td>
			<td>[
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
			]</td>
		</tr>
		<tr title="Stable sort">
			<td>sort([
				{
					"prop1": 0,
					"prop2": 0
				},
				{
					"prop1": 1,
					"prop2": 0
				},
				{
					"prop1": 2,
					"prop2": 0
				},
				{
					"prop1": 3,
					"prop2": 1
				},
				{
					"prop1": 4,
					"prop2": 1
				},
				{
					"prop1": 5,
					"prop2": 1
				},
				{
					"prop1": 6,
					"prop2": -1
				},
				{
					"prop1": 7,
					"prop2": -1
				},
				{
					"prop1": 8,
					"prop2": -1
				},
				{
					"prop1": 9,
					"prop2": 0
				},
				{
					"prop1": 10,
					"prop2": 0
				},
				{
					"prop1": 11,
					"prop2": 0
				}
			], "+prop2")</td>
			<td>[
				{
					"prop1": 6,
					"prop2": -1
				},
				{
					"prop1": 7,
					"prop2": -1
				},
				{
					"prop1": 8,
					"prop2": -1
				},
				{
					"prop1": 0,
					"prop2": 0
				},
				{
					"prop1": 1,
					"prop2": 0
				},
				{
					"prop1": 2,
					"prop2": 0
				},
				{
					"prop1": 9,
					"prop2": 0
				},
				{
					"prop1": 10,
					"prop2": 0
				},
				{
					"prop1": 11,
					"prop2": 0
				},
				{
					"prop1": 3,
					"prop2": 1
				},
				{
					"prop1": 4,
					"prop2": 1
				},
				{
					"prop1": 5,
					"prop2": 1
				}
			]</td>
		</tr>
		<tr title="Deep objects, multiple properties, arrays representing
			property values as arguments">
			<td>sort([
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 5
						},
						"prop22": 1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 5
						},
						"prop22": -1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 6
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 6
						},
						"prop22": 1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 6
						},
						"prop22": -1
					}
				}
			], [5, 5, 5, 6, 6, 6], "-prop11.prop21.prop31", [0, 1, -1, 0, 1, -1])</td>
			<td>[
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 6
						},
						"prop22": 1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 6
						},
						"prop22": -1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 6
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 5
						},
						"prop22": 1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 2,
							"prop32": 5
						},
						"prop22": -1
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5
						},
						"prop22": 0
					}
				},
			]</td>
		</tr>
		<tr title="Stable sort">
			<td>sort([
				{
					"prop1": 0,
					"prop2": 0
				},
				{
					"prop1": 1,
					"prop2": 0
				},
				{
					"prop1": 2,
					"prop2": 0
				},
				{
					"prop1": 3,
					"prop2": 1
				},
				{
					"prop1": 4,
					"prop2": 1
				},
				{
					"prop1": 5,
					"prop2": 1
				},
				{
					"prop1": 6,
					"prop2": -1
				},
				{
					"prop1": 7,
					"prop2": -1
				},
				{
					"prop1": 8,
					"prop2": -1
				},
				{
					"prop1": 9,
					"prop2": 0
				},
				{
					"prop1": 10,
					"prop2": 0
				},
				{
					"prop1": 11,
					"prop2": 0
				}
			], "+prop2")</td>
			<td>[
				{
					"prop1": 6,
					"prop2": -1
				},
				{
					"prop1": 7,
					"prop2": -1
				},
				{
					"prop1": 8,
					"prop2": -1
				},
				{
					"prop1": 0,
					"prop2": 0
				},
				{
					"prop1": 1,
					"prop2": 0
				},
				{
					"prop1": 2,
					"prop2": 0
				},
				{
					"prop1": 9,
					"prop2": 0
				},
				{
					"prop1": 10,
					"prop2": 0
				},
				{
					"prop1": 11,
					"prop2": 0
				},
				{
					"prop1": 3,
					"prop2": 1
				},
				{
					"prop1": 4,
					"prop2": 1
				},
				{
					"prop1": 5,
					"prop2": 1
				}
			]</td>
		</tr>
		<tr title="Stable sort decreasing">
			<td>sort([
				{
					"prop1": 0,
					"prop2": 0
				},
				{
					"prop1": 1,
					"prop2": 0
				},
				{
					"prop1": 2,
					"prop2": 0
				},
				{
					"prop1": 3,
					"prop2": 1
				},
				{
					"prop1": 4,
					"prop2": 1
				},
				{
					"prop1": 5,
					"prop2": 1
				},
				{
					"prop1": 6,
					"prop2": -1
				},
				{
					"prop1": 7,
					"prop2": -1
				},
				{
					"prop1": 8,
					"prop2": -1
				},
				{
					"prop1": 9,
					"prop2": 0
				},
				{
					"prop1": 10,
					"prop2": 0
				},
				{
					"prop1": 11,
					"prop2": 0
				}
			], "-prop2")</td>
			<td>[
				{
					"prop1": 3,
					"prop2": 1
				},
				{
					"prop1": 4,
					"prop2": 1
				},
				{
					"prop1": 5,
					"prop2": 1
				},
				{
					"prop1": 0,
					"prop2": 0
				},
				{
					"prop1": 1,
					"prop2": 0
				},
				{
					"prop1": 2,
					"prop2": 0
				},
				{
					"prop1": 9,
					"prop2": 0
				},
				{
					"prop1": 10,
					"prop2": 0
				},
				{
					"prop1": 11,
					"prop2": 0
				},
				{
					"prop1": 6,
					"prop2": -1
				},
				{
					"prop1": 7,
					"prop2": -1
				},
				{
					"prop1": 8,
					"prop2": -1
				}
			]</td>
		</tr>
	</table>
</section>

<section>
	<h1>Object sort, unexpected use cases</h1>

	<table class="reftest" data-test="expressionEvaluation" data-columns="3">
		<tr title="No properties given">
			<td>sort([
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
			])</td>
			<td>[
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
			]</td>
		</tr>

		<tr title="Property that doesn't exist given, followed by property that does exist">
			<td>sort([
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
			], "-prop11.prop21.prop31.prop41", "+prop11.prop22")</td>
			<td>[
				{
					"prop11": {
						"prop21": {
							"prop31": 0,
							"prop32": 5,
							"prop33": "bca"
						},
						"prop22": -1
					},
				},
				{
					"prop11": {
						"prop21": {
							"prop31": -1,
							"prop32": 5,
							"prop33": "cba"
						},
						"prop22": 0
					}
				},
				{
					"prop11": {
						"prop21": {
							"prop31": 1,
							"prop32": 5,
							"prop33": "abc"
						},
						"prop22": 1
					}
				},
			]</td>
		</tr>
	</table>

</section>

<section>
	<h1>Other sort</h1>

	<p class="note">Note that the string "undefined" in the Actual and Expected columns
	designates the value undefined, rather than the string undefined.  This is a
	workaround for testing.</p>

	<table class="reftest" data-test="expressionEvaluation" data-columns="3">
		<tr title="Booleans">
			<td>sort([false, true, false, true])</td>
			<td>[false, false, true, true]</td>
		</tr>
		<tr>
			<td>sort([false, false, true, false], "-")</td>
			<td>[true, false, false, false]</td>
		</tr>
		<tr title="Nulls and undefined mixed in ">
			<td>sort([4, null, 2, 0, -2, undefined, 1, null])</td>
			<td>[-2, 0, 1, 2, 4, null, null, undefined]</td>
		</tr>
		<tr>
			<td>sort([4, null, 2, 0, -2, undefined, 1, null], "-")</td>
			<td>[4, 2, 1, 0, -2, null, null, undefined]</td>
		</tr>
		<tr>
			<td>sort(["a", null, undefined, "m", undefined, "n", null, "o", "z"])</td>
			<td>["a", "m", "n", "o", "z", null, null, undefined, undefined]</td>
		</tr>
		<tr>
			<td>sort(["a", null, undefined, "m", undefined, "n", null, "o", "z"], "-")</td>
			<td>["z", "o", "n", "m", "a", null, null, undefined, undefined]</td>
		</tr>
		<tr>
			<td>sort([false, true, null, undefined, true, false])</td>
			<td>[false, false, true, true, null, undefined]</td>
		</tr>
		<tr>
			<td>sort([false, true, null, undefined, true, false], "-")</td>
			<td>[true, true, false, false, null, undefined]</td>
		</tr>
	</table>
</section>

<h1>mv-sort tests</h1>

<section>
	<h1>Collection sort</h1>
	<table class="reftest">
		<tr>
			<td>
				<pre id="collection0">
{
	"simpleCollection": [
		2,
		-2,
		1,
		0,
		-1
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Empty mv-sort">
			<td mv-app mv-storage="#collection0">
				<ul>
					<li property="simpleCollection" mv-multiple mv-sort></li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-sort>2</li><!--
					--><li mv-sort>-2</li><!--
					--><li mv-sort>1</li><!--
					--><li mv-sort>0</li><!--
					--><li mv-sort>-1</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection1">
{
	"simpleCollection": [
		2,
		-2,
		1,
		0,
		-1
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Primitives">
			<td mv-app mv-storage="#collection1">
				<ul>
					<li property="simpleCollection" mv-multiple mv-sort="+"></li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-sort="+">-2</li><!--
					--><li mv-sort="+">-1</li><!--
					--><li mv-sort="+">0</li><!--
					--><li mv-sort="+">1</li><!--
					--><li mv-sort="+">2</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection2">
{
	"simpleCollection": [
		2,
		-2,
		1,
		0,
		-1
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr>
			<td mv-app mv-storage="#collection2">
				<ul>
					<li property="simpleCollection" mv-multiple mv-sort="+"></li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-sort="+">-2</li><!--
					--><li mv-sort="+">-1</li><!--
					--><li mv-sort="+">0</li><!--
					--><li mv-sort="+">1</li><!--
					--><li mv-sort="+">2</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection3">
{
	"simpleCollection": [
		2,
		-2,
		1,
		0,
		-1
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr>
			<td mv-app mv-storage="#collection3">
				<ul>
					<li property="simpleCollection" mv-multiple mv-sort="-"></li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-sort="-">2</li><!--
					--><li mv-sort="-">1</li><!--
					--><li mv-sort="-">0</li><!--
					--><li mv-sort="-">-1</li><!--
					--><li mv-sort="-">-2</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection4">
{
	"simpleGroup": [
		{
			"prop1": "a",
			"prop2": 2
		},
		{
			"prop1": "b",
			"prop2": 2
		},
		{
			"prop1": "c",
			"prop2": 1
		},
		{
			"prop1": "d",
			"prop2": 1
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Simple group">
			<td mv-app mv-storage="#collection4">
				<ul>
					<li property="simpleGroup" mv-multiple mv-sort="+prop2 -prop1">
						<span style="color: blue" property="prop1"></span>
						<span style="color: lightblue" property="prop2"></span>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>
						<span style="color: blue">d</span>
						<span style="color: lightblue">1</span>
					</li>
					<li>
						<span style="color: blue">c</span>
						<span style="color: lightblue">1</span>
					</li>
					<li>
						<span style="color: blue">b</span>
						<span style="color: lightblue">2</span>
					</li>
					<li>
						<span style="color: blue">a</span>
						<span style="color: lightblue">2</span>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection5">
{
	"simpleGroup": [
		{
			"prop1": "a",
			"prop2": 2
		},
		{
			"prop1": "b",
			"prop2": 2
		},
		{
			"prop1": "c",
			"prop2": 1
		},
		{
			"prop1": "d",
			"prop2": 1
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Simple group (comma separated properties in mv-sort)">
			<td mv-app mv-storage="#collection5">
				<ul>
					<li property="simpleGroup" mv-multiple mv-sort="+prop2,-prop1">
						<span style="color: blue" property="prop1"></span>
						<span style="color: lightblue" property="prop2"></span>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">d</span>
						<span style="color: lightblue">1</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">c</span>
						<span style="color: lightblue">1</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">b</span>
						<span style="color: lightblue">2</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">a</span>
						<span style="color: lightblue">2</span>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection6">
{
	"simpleGroup": [
		{
			"prop1": "a",
			"prop2": 2
		},
		{
			"prop1": "b",
			"prop2": 2
		},
		{
			"prop1": "c",
			"prop2": 1
		},
		{
			"prop1": "d",
			"prop2": 1
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Updating simple group (check all boxes and click Save)" class="interactive">
			<td mv-app mv-storage="#collection6">
				<div>
					<input type="checkbox" mv-storage="none" property="check1">
					<input type="checkbox" mv-storage="none" property="check2">
				</div>
				<ul>
					<li property="simpleGroup" mv-multiple mv-sort="[if(check1, '+prop2')]
						[if (check2, '-prop1')]">
						<span style="color: blue" property="prop1"></span>
						<span style="color: lightblue" property="prop2"></span>
					</li>
				</ul>
			</td>
			<td>
				<div>
					<input type="checkbox">
					<input type="checkbox">
				</div>
				<ul>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">d</span>
						<span style="color: lightblue">1</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">c</span>
						<span style="color: lightblue">1</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">b</span>
						<span style="color: lightblue">2</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">a</span>
						<span style="color: lightblue">2</span>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection7">
{
	"simpleGroup": [
		{
			"prop1": "a",
			"prop2": 2
		},
		{
			"prop1": "b",
			"prop2": 2
		},
		{
			"prop1": "c",
			"prop2": 1
		},
		{
			"prop1": "d",
			"prop2": 1
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Updating simple group (comma separated values in mv-sort) (check all boxes and click Save)" class="interactive">
			<td mv-app mv-storage="#collection7">
				<div>
					<input type="checkbox" mv-storage="none" property="check1">
					<input type="checkbox" mv-storage="none" property="check2">
				</div>
				<ul>
					<li property="simpleGroup" mv-multiple mv-sort="[if(check1, '+prop2')],
						[if (check2, '-prop1')]">
						<span style="color: blue" property="prop1"></span>
						<span style="color: lightblue" property="prop2"></span>
					</li>
				</ul>
			</td>
			<td>
				<div>
					<input type="checkbox">
					<input type="checkbox">
				</div>
				<ul>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">d</span>
						<span style="color: lightblue">1</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">c</span>
						<span style="color: lightblue">1</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">b</span>
						<span style="color: lightblue">2</span>
					</li>
					<li mv-sort="prop2 -prop1">
						<span style="color: blue">a</span>
						<span style="color: lightblue">2</span>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection8">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 1
				},
				"prop22": -1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -2
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": -2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": 0
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Deep Group">
			<td mv-app mv-storage="#collection8">
				<ul>
					<li property="deepGroup" mv-multiple mv-sort="+prop11.prop12.prop13">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-sort="prop11.prop12.prop13">
						<div>
							<div>
								<span>-2</span>
							</div>
							<div>2</div>
						</div>
					</li>
					<li mv-sort="prop11.prop12.prop13">
						<div>
							<div>
								<span>-1</span>
							</div>
							<div>1</div>
						</div>
					</li>
					<li mv-sort="prop11.prop12.prop13">
						<div>
							<div>
								<span>0</span>
							</div>
							<div>0</div>
						</div>
					</li>
					<li mv-sort="prop11.prop12.prop13">
						<div>
							<div>
								<span>1</span>
							</div>
							<div>-1</div>
						</div>
					</li>
					<li mv-sort="prop11.prop12.prop13">
						<div>
							<div>
								<span>2</span>
							</div>
							<div>-2</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection9">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 1
				},
				"prop22": -1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -2
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": -2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": 0
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Deep Group with update (check all boxes and click Save)" class="interactive">
			<td mv-app mv-storage="#collection9">
				<div>
					<input type="checkbox" mv-storage="none" property="check1">
				</div>
				<ul>
					<li property="deepGroup" mv-multiple mv-sort="[if(check1,
						'-prop11.prop12.prop13')]">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<div>
						<input type="checkbox">
					</div>
					<li mv-sort="-prop11.prop12.prop13">
						<div>
							<div>
								<span>2</span>
							</div>
							<div>-2</div>
						</div>
					</li>
					<li mv-sort="-prop11.prop12.prop13">
						<div>
							<div>
								<span>1</span>
							</div>
							<div>-1</div>
						</div>
					</li>
					<li mv-sort="-prop11.prop12.prop13">
						<div>
							<div>
								<span>0</span>
							</div>
							<div>0</div>
						</div>
					</li>
					<li mv-sort="-prop11.prop12.prop13">
						<div>
							<div>
								<span>-1</span>
							</div>
							<div>1</div>
						</div>
					</li>
					<li mv-sort="-prop11.prop12.prop13">
						<div>
							<div>
								<span>-2</span>
							</div>
							<div>2</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection10">
{
	"nestedCollection": [
		{
			"prop11": 1,
			"prop12": [
				4,
				5,
				2,
				1,
				3
			]
		},
		{
			"prop11": -1,
			"prop12": [
				-3,
				-2,
				-5,
				-1,
				-4
			]
		},
		{
			"prop11": 0,
			"prop12": [
				1,
				0,
				-2,
				-1,
				2
			]
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Nested Collections">
			<td mv-app mv-storage="#collection10">
				<ul>
					<li property="nestedCollection" mv-multiple mv-sort="+prop11">
						<div property="prop11"></div>
						<ul>
							<li property="prop12" mv-multiple mv-sort="-"></li>
						</ul>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-sort="prop11">
						<div>-1</div>
						<ul>
							<li mv-sort="-">-1</li><!--
							--><li mv-sort="-">-2</li><!--
							--><li mv-sort="-">-3</li><!--
							--><li mv-sort="-">-4</li><!--
							--><li mv-sort="-">-5</li>
						</ul>
					</li>
					<li mv-sort="prop11">
						<div>0</div>
						<ul>
							<li mv-sort="-">2</li><!--
							--><li mv-sort="-">1</li><!--
							--><li mv-sort="-">0</li><!--
							--><li mv-sort="-">-1</li><!--
							--><li mv-sort="-">-2</li>
						</ul>
					</li>
					<li mv-sort="prop11">
						<div>1</div>
						<ul>
							<li mv-sort="-">5</li><!--
							--><li mv-sort="-">4</li><!--
							--><li mv-sort="-">3</li><!--
							--><li mv-sort="-">2</li><!--
							--><li mv-sort="-">1</li>
						</ul>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection11">
{
	"nestedCollection": [
		{
			"prop11": 1,
			"prop12": [
				4,
				5,
				2,
				1,
				3
			]
		},
		{
			"prop11": -1,
			"prop12": [
				-3,
				-2,
				-5,
				-1,
				-4
			]
		},
		{
			"prop11": 0,
			"prop12": [
				1,
				0,
				-2,
				-1,
				2
			]
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Updating nested collections (check all boxes and click Save)" class="interactive">
			<td mv-app mv-storage="#collection11">
				<div>
					<input type="checkbox" mv-storage="none" property="check1">
					<input type="checkbox" mv-storage="none" property="check2">
				</div>
				<ul>
					<li property="nestedCollection" mv-multiple mv-sort="[if(check1, '+prop11')]">
						<div property="prop11"></div>
						<ul>
							<li property="prop12" mv-multiple mv-sort="[if(check2, '-')]"></li>
						</ul>
					</li>
				</ul>
			</td>
			<td>
				<div>
					<input type="checkbox">
					<input type="checkbox">
				</div>
				<ul>
					<li mv-sort="prop11">
						<div>-1</div>
						<ul>
							<li mv-sort="-">-1</li><!--
							--><li mv-sort="-">-2</li><!--
							--><li mv-sort="-">-3</li><!--
							--><li mv-sort="-">-4</li><!--
							--><li mv-sort="-">-5</li>
						</ul>
					</li>
					<li mv-sort="prop11">
						<div>0</div>
						<ul>
							<li mv-sort="-">2</li><!--
							--><li mv-sort="-">1</li><!--
							--><li mv-sort="-">0</li><!--
							--><li mv-sort="-">-1</li><!--
							--><li mv-sort="-">-2</li>
						</ul>
					</li>
					<li mv-sort="prop11">
						<div>1</div>
						<ul>
							<li mv-sort="-">5</li><!--
							--><li mv-sort="-">4</li><!--
							--><li mv-sort="-">3</li><!--
							--><li mv-sort="-">2</li><!--
							--><li mv-sort="-">1</li>
						</ul>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection12">
{
	"prop13": 7,
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": 0
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 5
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 4
				},
				"prop22": 3
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": 4
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Referencing a deep property by just its property name (no dot
			notation)">
			<td mv-app mv-storage="#collection12">
				<div property="prop13"></div>
				<ul>
					<li property="deepGroup" mv-multiple mv-sort="+prop13">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<div>7</div>
				<ul>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>1</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>0</div>
							</div>
							<div>4</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>2</div>
							</div>
							<div>0</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>4</div>
							</div>
							<div>3</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>5</div>
							</div>
							<div>2</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection13">
{
	"prop13": 7,
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": 0
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 5
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 4
				},
				"prop22": 3
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": 4
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Referencing a deep property by just its property name (no dot
			notation, decreasing order)">
			<td mv-app mv-storage="#collection13">
				<div property="prop13"></div>
				<ul>
					<li property="deepGroup" mv-multiple mv-sort="-prop13">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<div>7</div>
				<ul>
					<li>
						<div>
							<div>
								<div>5</div>
							</div>
							<div>2</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>4</div>
							</div>
							<div>3</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>2</div>
							</div>
							<div>0</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>0</div>
							</div>
							<div>4</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>1</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection14">
{
	"simpleGroup": [
		{
			"prop1": "a",
			"prop2": 2,
			"prop3": 0
		},
		{
			"prop1": "b",
			"prop2": 2,
			"prop3": 1
		},
		{
			"prop1": "a",
			"prop2": 2,
			"prop3": 2
		},
		{
			"prop1": "c",
			"prop2": 1,
			"prop3": 3
		},
		{
			"prop1": "d",
			"prop2": 1,
			"prop3": 4
		},
		{
			"prop1": "d",
			"prop2": 1,
			"prop3": 5
		}
	],
	"props": [
		"+prop2",
		"-prop1",
		"-prop3"
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Using collection for sort properties">
			<td mv-app mv-storage="#collection14">
				<ul>
					<li property="props" mv-multiple></li>
				</ul>
				<ul>
					<li property="simpleGroup" mv-multiple mv-sort="[props]">
						<span property="prop1"></span>
						<span property="prop2"></span>
						<span property="prop3"></span>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>+prop2</li><!--
					--><li>-prop1</li><!--
					--><li>-prop3</li>
				</ul>
				<ul>
					<li>
						<span>d</span>
						<span>1</span>
						<span>5</span>
					</li>
					<li>
						<span>d</span>
						<span>1</span>
						<span>4</span>
					</li>
					<li>
						<span>c</span>
						<span>1</span>
						<span>3</span>
					</li>
					<li>
						<span>b</span>
						<span>2</span>
						<span>1</span>
					</li>
					<li>
						<span>a</span>
						<span>2</span>
						<span>2</span>
					</li>
					<li>
						<span>a</span>
						<span>2</span>
						<span>0</span>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection15">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 5
				},
				"prop22": 0
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Unsorted collection and sorted collection referenced with
			mv-value (passing collection itself as argument)">
			<td mv-app mv-storage="#collection15">
				<ul>
					<li property="deepGroup" mv-multiple>
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
				<ul>
					<li property="deepGroup2" mv-multiple mv-value="sort(deepGroup, prop13)">
						<div property="prop11">
							<div property="prop12">
								<div>[prop13]</div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>
						<div>
							<div>
								<div>2</div>
							</div>
							<div>2</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>1</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>5</div>
							</div>
							<div>0</div>
						</div>
					</li>
				</ul>
				<ul>
					<li>
						<div>
							<div>
								<div>5</div>
							</div>
							<div>0</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>2</div>
							</div>
							<div>2</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>1</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection16">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 5
				},
				"prop22": 0
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 4
				},
				"prop22": 3
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 6
				},
				"prop22": 2
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Referencing property with mv-path">
			<td mv-app mv-storage="#collection16">
				<ul>
					<li property="deepGroup" mv-multiple mv-sort="prop11">
						<div property="prop11" mv-path="prop12/prop13">
						</div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>
						<div>6</div>
					</li>
					<li>
						<div>5</div>
					</li>
					<li>
						<div>4</div>
					</li>
					<li>
						<div>2</div>
					</li>
					<li>
						<div>-1</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection17">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 5
				},
				"prop22": 0
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 4
				},
				"prop22": 3
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 6
				},
				"prop22": 2
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<pre>
{
	"deepGroup": [
		{
			"newProp": {
				"prop12": {
					"prop13": 2
				},
				"prop22": 2
			}
		},
		{
			"newProp": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		},
		{
			"newProp": {
				"prop12": {
					"prop13": 5
				},
				"prop22": 0
			}
		},
		{
			"newProp": {
				"prop12": {
					"prop13": 4
				},
				"prop22": 3
			}
		},
		{
			"newProp": {
				"prop12": {
					"prop13": 6
				},
				"prop22": 2
			}
		}
	]
}
				</pre>
			</td>
		</tr>
		<tr title="Referencing property with mv-alias and mv-path">
			<td mv-app mv-storage="#collection17">
				<ul>
					<li property="deepGroup" mv-multiple mv-sort="newProp">
						<div property="newProp" mv-alias="prop11" mv-path="prop12/prop13">
						</div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>
						<div>6</div>
					</li>
					<li>
						<div>5</div>
					</li>
					<li>
						<div>4</div>
					</li>
					<li>
						<div>2</div>
					</li>
					<li>
						<div>-1</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection18">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": 2
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": 1
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 5
				},
				"prop22": 0
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 4
				},
				"prop22": 3
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 6
				},
				"prop22": 2
			}
		}
	]
}
				</pre>
			</td>
		</tr>
		<tr title="Resort on mv-change">
			<td mv-app mv-storage="#collection18">
				<input id="c18cb" type="checkbox">
				<ul>
					<li property="deepGroup" mv-multiple mv-sort="-prop22">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22" class="propVal"></div>
						</div>
					</li>
				</ul>
			</td>
			<script>
				$("#c18cb").addEventListener("click", function(e) {
					$$(".propVal").forEach(function(elem) {
						var val = parseInt(elem.innerHTML);
						var node = Mavo.Node.get(elem);
						node.value = -val;
					});
				});
			</script>
			<td>
				<input type="checkbox">
				<ul>
					<li>
						<div>5</div>
						<div>0</div>
					</li>
					<li>
						<div>-1</div>
						<div>-1</div>
					</li>
					<li>
						<div>2</div>
						<div>-2</div>
					</li>
					<li>
						<div>6</div>
						<div>-2</div>
					</li>
					<li>
						<div>4</div>
						<div>-3</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr title="Resort when mv-if visible">
			<td>
				<pre id="collection19">
{
	"simpleGroup": [
		{
			"prop1": "a",
			"prop2": 2
		},
		{
			"prop1": "b",
			"prop2": 2
		},
		{
			"prop1": "c",
			"prop2": 1
		},
		{
			"prop1": "d",
			"prop2": 1
		}
	],
	"show": false
}
				</pre>
			</td>
			<td>
				<pre>
{
	"simpleGroup": [
		{
			"prop1": "a",
			"prop2": 2
		},
		{
			"prop1": "b",
			"prop2": 2
		},
		{
			"prop1": "c",
			"prop2": 1
		},
		{
			"prop1": "d",
			"prop2": 1
		}
	],
	"show": true
}
				</pre>
			</td>
		</tr>
		<tr>
			<td mv-app mv-storage="#collection19">
				<input type="checkbox" property="show">
				<ul mv-if="show">
					<li property="simpleGroup"
					    mv-multiple
					    mv-sort="[if(show, '-prop1', '+prop1')]">
						<div property="prop1"></div>
						<div property="prop2"></div>
					</li>
				</ul>
			</td>
			<td>
				<input type="checkbox" property="show">
				<ul>
					<li>
						<div>d</div>
						<div>1</div>
					</li>
					<li>
						<div>c</div>
						<div>1</div>
					</li>
					<li>
						<div>b</div>
						<div>2</div>
					</li>
					<li>
						<div>a</div>
						<div>2</div>
					</li>
				</ul>
			</td>
		</tr>
	</table>
</section>

<h1>Group tests</h1>

<section>
	<h1>Group simple objects</h1>
	<table class="reftest" data-test="expressionEvaluation" data-columns="3">

		<tr title="Empty array no properties">
			<td>groupBy([])</td>
			<td>([])</td>
		</tr>

		<tr title="Empty array some properties">
			<td>groupBy([], "prop1", "prop2", "prop3")</td>
			<td>([])</td>
		</tr>

		<tr title="Non-empty array no properties">
			<td>groupBy([
				{"id": 0, "p1": "p1v1"},
				{"id": 1, "p1": "p1v1"},
				{"id": 2, "p1": "p1v2"},
				{"id": 3, "p1": "p1v2"}
			])</td>
			<td>([])</td>
		</tr>

		<tr title="Non-empty array one property">
			<td>groupBy([
				{"id": 0, "p1": "p1v1"},
				{"id": 1, "p1": "p1v1"},
				{"id": 2, "p1": "p1v2"},
				{"id": 3, "p1": "p1v2"}
			], "+p1")</td>
			<td>([
				{
					"id": "p1v1",
					"property": "p1",
					"items": [
						{"id": 0, "p1": "p1v1"},
						{"id": 1, "p1": "p1v1"}
					]
				},
				{
					"id": "p1v2",
					"property": "p1",
					"items": [
						{"id": 2, "p1": "p1v2"},
						{"id": 3, "p1": "p1v2"}
					]
				}
			])</td>
		</tr>

		<tr title="Non-empty array non-existent property">
			<td>groupBy([
				{"id": 0, "p1": "p1v1"},
				{"id": 1, "p1": "p1v1"},
				{"id": 2, "p1": "p1v2"},
				{"id": 3, "p1": "p1v2"}
			], "+p2")</td>
			<td>([])</td>
		</tr>

		<tr title="Non-empty array one property reverse sort">
			<td>groupBy([
				{"id": 0, "p1": "p1v1"},
				{"id": 1, "p1": "p1v1"},
				{"id": 2, "p1": "p1v2"},
				{"id": 3, "p1": "p1v2"}
			], "-p1")</td>
			<td>([
				{
					"id": "p1v2",
					"property": "p1",
					"items": [
						{"id": 2, "p1": "p1v2"},
						{"id": 3, "p1": "p1v2"}
					]
				},
				{
					"id": "p1v1",
					"property": "p1",
					"items": [
						{"id": 0, "p1": "p1v1"},
						{"id": 1, "p1": "p1v1"}
					]
				},
			])</td>
		</tr>

		<tr title="Non-empty array multiple properties">
			<td>groupBy([
				{"id": 0, "p1": "p1v1", "p2": "p2v1"},
				{"id": 1, "p1": "p1v1", "p2": "p2v1"},
				{"id": 2, "p1": "p1v1", "p2": "p2v2"},
				{"id": 3, "p1": "p1v1", "p2": "p2v2"},
				{"id": 4, "p1": "p1v2", "p2": "p2v1"},
				{"id": 5, "p1": "p1v2", "p2": "p2v1"},
				{"id": 6, "p1": "p1v2", "p2": "p2v2"},
				{"id": 7, "p1": "p1v2", "p2": "p2v2"}
			], "+p2", "+p1")</td>
			<td>([
				{
					"id": "p2v1",
					"property": "p2",
					"items": [
						{
							"id": "p1v1",
							"property": "p1",
							"items": [
								{"id": 0, "p1": "p1v1", "p2": "p2v1"},
								{"id": 1, "p1": "p1v1", "p2": "p2v1"},
							]
						},
						{
							"id": "p1v2",
							"property": "p1",
							"items": [
								{"id": 4, "p1": "p1v2", "p2": "p2v1"},
								{"id": 5, "p1": "p1v2", "p2": "p2v1"},
							]
						},
					]
				},
				{
					"id": "p2v2",
					"property": "p2",
					"items": [
						{
							"id": "p1v1",
							"property": "p1",
							"items": [
								{"id": 2, "p1": "p1v1", "p2": "p2v2"},
								{"id": 3, "p1": "p1v1", "p2": "p2v2"},
							]
						},
						{
							"id": "p1v2",
							"property": "p1",
							"items": [
								{"id": 6, "p1": "p1v2", "p2": "p2v2"},
								{"id": 7, "p1": "p1v2", "p2": "p2v2"},
							]
						},
					]
				},
			])</td>
		</tr>

		<tr title="Non-empty array multiple properties, stable">
			<td>groupBy([
				{"id": 3, "p1": "p1v1", "p2": "p2v2"},
				{"id": 0, "p1": "p1v1", "p2": "p2v1"},
				{"id": 5, "p1": "p1v2", "p2": "p2v1"},
				{"id": 7, "p1": "p1v2", "p2": "p2v2"},
				{"id": 4, "p1": "p1v2", "p2": "p2v1"},
				{"id": 1, "p1": "p1v1", "p2": "p2v1"},
				{"id": 2, "p1": "p1v1", "p2": "p2v2"},
				{"id": 6, "p1": "p1v2", "p2": "p2v2"},
			], "+p1", "-p2")</td>
			<td>([
				{
					"id": "p1v1",
					"property": "p1",
					"items": [
						{
							"id": "p2v2",
							"property": "p2",
							"items": [
								{"id": 3, "p1": "p1v1", "p2": "p2v2"},
								{"id": 2, "p1": "p1v1", "p2": "p2v2"},
							]
						},
						{
							"id": "p2v1",
							"property": "p2",
							"items": [
								{"id": 0, "p1": "p1v1", "p2": "p2v1"},
								{"id": 1, "p1": "p1v1", "p2": "p2v1"},
							]
						},
					]
				},
				{
					"id": "p1v2",
					"property": "p1",
					"items": [
						{
							"id": "p2v2",
							"property": "p2",
							"items": [
								{"id": 7, "p1": "p1v2", "p2": "p2v2"},
								{"id": 6, "p1": "p1v2", "p2": "p2v2"},
							]
						},
						{
							"id": "p2v1",
							"property": "p2",
							"items": [
								{"id": 5, "p1": "p1v2", "p2": "p2v1"},
								{"id": 4, "p1": "p1v2", "p2": "p2v1"},
							]
						},
					]
				},
			])</td>
		</tr>
	</table>
</section>

<h1>mv-groupby tests</h1>

<section>
	<h1>Collection sort</h1>
	<table class="reftest">
		<tr>
			<td>
				<pre id="collection20">
{
	"simpleCollection": [
		{
			"id": 0,
			"p1": "p1v1"
		},
		{
			"id": 1,
			"p1": "p1v1"
		},
		{
			"id": 2,
			"p1": "p1v2"
		},
		{
			"id": 3,
			"p1": "p1v2"
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Empty mv-groupby">
			<td mv-app mv-storage="#collection20">
				<ul>
					<li property="simpleCollection" mv-multiple mv-groupby>
						<div property="id"></div>
						<div property="p1"></div>
						<br>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>
						<div>0</div>
						<div>p1v1</div>
						<br>
					</li>
					<li>
						<div>1</div>
						<div>p1v1</div>
						<br>
					</li>
					<li>
						<div>2</div>
						<div>p1v2</div>
						<br>
					</li>
					<li>
						<div>3</div>
						<div>p1v2</div>
						<br>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection21">
{
	"simpleCollection": [
		{
			"id": 0,
			"p1": "p1v1"
		},
		{
			"id": 1,
			"p1": "p1v1"
		},
		{
			"id": 2,
			"p1": "p1v2"
		},
		{
			"id": 3,
			"p1": "p1v2"
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Empty string mv-groupby">
			<td mv-app mv-storage="#collection21">
				<ul>
					<li property="simpleCollection" mv-multiple mv-groupby="">
						<div property="id"></div>
						<div property="p1"></div>
						<br>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li mv-groupby>
						<div>0</div>
						<div>p1v1</div>
						<br>
					</li>
					<li mv-groupby>
						<div>1</div>
						<div>p1v1</div>
						<br>
					</li>
					<li mv-groupby>
						<div>2</div>
						<div>p1v2</div>
						<br>
					</li>
					<li mv-groupby>
						<div>3</div>
						<div>p1v2</div>
						<br>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection22">
{
	"simpleCollection": [
		{
			"id": 0,
			"p1": "p1v1"
		},
		{
			"id": 1,
			"p1": "p1v1"
		},
		{
			"id": 2,
			"p1": "p1v2"
		},
		{
			"id": 3,
			"p1": "p1v2"
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Non-existent property mv-groupby">
			<td mv-app mv-storage="#collection22">
				<ul>
					<li mv-multiple="simpleCollection" mv-groupby="p2">
						<div property="id"></div>
						<div property="p1"></div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>
						<div>0</div>
						<div>p1v1</div>
					</li>
					<li>
						<div>1</div>
						<div>p1v1</div>
					</li>
					<li>
						<div>2</div>
						<div>p1v2</div>
					</li>
					<li>
						<div>3</div>
						<div>p1v2</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection23">
{
	"simpleCollection": [
		{
			"id": 0,
			"p1": "p1v1"
		},
		{
			"id": 1,
			"p1": "p1v1"
		},
		{
			"id": 2,
			"p1": "p1v2"
		},
		{
			"id": 3,
			"p1": "p1v2"
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Single property decreasing order">
			<td mv-app mv-storage="#collection23">
				<b class="mv-group-heading"></b>
				<div mv-multiple="simpleCollection" mv-groupby="-p1">
					<div property="id"></div>
					<div property="p1"></div>
				</div>
			</td>
			<td>
				<b>p1v2</b>
				<div>
					<div>2</div>
					<div>p1v2</div>
				</div>
				<div>
					<div>3</div>
					<div>p1v2</div>
				</div>
				<b>p1v1</b>
				<div>
					<div>0</div>
					<div>p1v1</div>
				</div>
				<div>
					<div>1</div>
					<div>p1v1</div>
				</div>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection24">
{
	"simpleCollection": [
		{
			"id": 0,
			"p1": "p1v1"
		},
		{
			"id": 1,
			"p1": "p1v1"
		},
		{
			"id": 2,
			"p1": "p1v2"
		},
		{
			"id": 3,
			"p1": "p1v2"
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Single property increasing order">
			<td mv-app mv-storage="#collection24">
				<b class="mv-group-heading"></b>
				<div mv-multiple="simpleCollection" mv-groupby="+p1">
					<div property="id"></div>
					<div property="p1"></div>
				</div>
			</td>
			<td>
				<b>p1v1</b>
				<div>
					<div>0</div>
					<div>p1v1</div>
				</div>
				<div>
					<div>1</div>
					<div>p1v1</div>
				</div>
				<b>p1v2</b>
				<div>
					<div>2</div>
					<div>p1v2</div>
				</div>
				<div>
					<div>3</div>
					<div>p1v2</div>
				</div>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection25">
{
	"simpleCollection": [
		{
			"id": 0,
			"p1": "p1v1",
			"p2": "p2v1"
		},
		{
			"id": 1,
			"p1": "p1v1",
			"p2": "p2v1"
		},
		{
			"id": 2,
			"p1": "p1v2",
			"p2": "p2v2"
		},
		{
			"id": 3,
			"p1": "p1v2",
			"p2": "p2v2"
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Updating grouping">
			<td mv-app mv-storage="#collection25">
				<div>
					<input property="check" mv-storage="none" type="checkbox">
				</div>
				<b class="mv-group-heading"></b>
				<div mv-multiple="simpleCollection" mv-groupby="[if(check, '+p2', '-p1')]">
					<div property="id"></div>
					<div property="p1"></div>
					<div property="p2"></div>
				</div>
			</td>
			<td>
				<div>
					<input type="checkbox">
				</div>
				<b>p2v1</b>
				<div>
					<div>0</div>
					<div>p1v1</div>
					<div>p2v1</div>
				</div>
				<div>
					<div>1</div>
					<div>p1v1</div>
					<div>p2v1</div>
				</div>
				<b>p2v2</b>
				<div>
					<div>2</div>
					<div>p1v2</div>
					<div>p2v2</div>
				</div>
				<div>
					<div>3</div>
					<div>p1v2</div>
					<div>p2v2</div>
				</div>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection26">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 1
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -2
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": "abc"
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Group by deep property (dot notation)">
			<td mv-app mv-storage="#collection26">
				<ul>
					<b class="mv-group-heading"></b>
					<li property="deepGroup" mv-multiple mv-groupby="+prop11.prop22">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<b>abc</b>
					<li>
						<div>
							<div>
								<div>-2</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>0</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<b>cba</b>
					<li>
						<div>
							<div>
								<span>1</span>
							</div>
							<div>cba</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<span>2</span>
							</div>
							<div>cba</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection27">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 1
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -2
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": "abc"
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Group by deep property with update (dot notation)">
			<td mv-app mv-storage="#collection27">
				<div>
					<input type="checkbox" mv-storage="none" property="check">
				</div>
				<ul>
					<b class="mv-group-heading"></b>
					<li property="deepGroup" mv-multiple mv-groupby="[if(check,
						'-prop11.prop22')]">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<div>
					<input type="checkbox">
				</div>
				<ul>
					<b>cba</b>
					<li>
						<div>
							<div>
								<span>1</span>
							</div>
							<div>cba</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<span>2</span>
							</div>
							<div>cba</div>
						</div>
					</li>
					<b>abc</b>
					<li>
						<div>
							<div>
								<div>-2</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>0</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>abc</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection28">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 1
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -2
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": "abc"
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Updating a deep property by just its property name (no dot
			notation)">
			<td mv-app mv-storage="#collection28">
				<div>
					<input type="checkbox" mv-storage="none" property="check">
				</div>
				<ul>
					<b class="mv-group-heading"></b>
					<li property="deepGroup" mv-multiple mv-groupby="[if(check,
						'-prop22')]">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<div>
					<input type="checkbox">
				</div>
				<ul>
					<b>cba</b>
					<li>
						<div>
							<div>
								<span>1</span>
							</div>
							<div>cba</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<span>2</span>
							</div>
							<div>cba</div>
						</div>
					</li>
					<b>abc</b>
					<li>
						<div>
							<div>
								<div>-2</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>0</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>abc</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection29">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 1
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -2
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": "abc"
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Update from grouped to empty mv-groupby">
			<td mv-app mv-storage="#collection29">
				<div>
					<input type="checkbox" mv-storage="none" property="check">
				</div>
				<ul>
					<b class="mv-group-heading"></b>
					<li property="deepGroup" mv-multiple mv-groupby="[if(!check,
						'-prop11.prop22')]">
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<div>
					<input type="checkbox">
				</div>
				<ul>
					<li>
						<div>
							<div>
								<span>1</span>
							</div>
							<div>cba</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-2</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<span>2</span>
							</div>
							<div>cba</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>0</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>abc</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection30">
{
	"nestedCollection": [
		{
			"prop11": "ab",
			"prop12": [
				{
					"id": 0,
					"prop121": "ba"
				},
				{
					"id": 1,
					"prop121": "bb"
				},
				{
					"id": 2,
					"prop121": "ba"
				}
			]
		},
		{
			"prop11": "aa",
			"prop12": [
				{
					"id": 0,
					"prop121": "cb"
				},
				{
					"id": 1,
					"prop121": "ca"
				},
				{
					"id": 2,
					"prop121": "cb"
				}
			]
		},
		{
			"prop11": "aa",
			"prop12": [
				{
					"id": 0,
					"prop121": "da"
				},
				{
					"id": 1,
					"prop121": "db"
				},
				{
					"id": 2,
					"prop121": "db"
				}
			]
		},
		{
			"prop11": "ab",
			"prop12": [
				{
					"id": 0,
					"prop121": "ea"
				},
				{
					"id": 1,
					"prop121": "eb"
				},
				{
					"id": 2,
					"prop121": "ea"
				}
			]
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Nested Collections">
			<td mv-app mv-storage="#collection30">
				<ul>
					<h5 class="mv-group-heading"></h6>
					<li property="nestedCollection" mv-multiple mv-groupby="+prop11">
						<div property="prop11"></div>
						<ul>
							<h6 class="mv-group-heading"></h6>
							<li property="prop12" mv-multiple mv-groupby="-prop121">
								<div property="id"></div>
								<div property="prop121"></div>
							</li>
						</ul>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<h5>aa</h5>
					<li>
						<div>aa</div>
						<ul>
							<h6>cb</h6>
							<li>
								<div>0</div>
								<div>cb</div>
							</li>
							<li>
								<div>2</div>
								<div>cb</div>
							</li>
							<h6>ca</h6>
							<li>
								<div>1</div>
								<div>ca</div>
							</li>
						</ul>
					</li>
					<li>
						<div>aa</div>
						<ul>
							<h6>db</h6>
							<li>
								<div>1</div>
								<div>db</div>
							</li>
							<li>
								<div>2</div>
								<div>db</div>
							</li>
							<h6>da</h6>
							<li>
								<div>0</div>
								<div>da</div>
							</li>
						</ul>
					</li>
					<h5>ab</h5>
					<li>
						<div>ab</div>
						<ul>
							<h6>bb</h6>
							<li>
								<div>1</div>
								<div>bb</div>
							</li>
							<h6>ba</h6>
							<li>
								<div>0</div>
								<div>ba</div>
							</li>
							<li>
								<div>2</div>
								<div>ba</div>
							</li>
						</ul>
					</li>
					<li>
						<div>ab</div>
						<ul>
							<h6>eb</h6>
							<li>
								<div>1</div>
								<div>eb</div>
							</li>
							<h6>ea</h6>
							<li>
								<div>0</div>
								<div>ea</div>
							</li>
							<li>
								<div>2</div>
								<div>ea</div>
							</li>
						</ul>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection31">
{
	"nestedCollection": [
		{
			"prop11": "ab",
			"prop12": [
				{
					"id": 0,
					"prop121": "ba"
				},
				{
					"id": 1,
					"prop121": "bb"
				},
				{
					"id": 2,
					"prop121": "ba"
				}
			]
		},
		{
			"prop11": "aa",
			"prop12": [
				{
					"id": 0,
					"prop121": "cb"
				},
				{
					"id": 1,
					"prop121": "ca"
				},
				{
					"id": 2,
					"prop121": "cb"
				}
			]
		},
		{
			"prop11": "aa",
			"prop12": [
				{
					"id": 0,
					"prop121": "da"
				},
				{
					"id": 1,
					"prop121": "db"
				},
				{
					"id": 2,
					"prop121": "db"
				}
			]
		},
		{
			"prop11": "ab",
			"prop12": [
				{
					"id": 0,
					"prop121": "ea"
				},
				{
					"id": 1,
					"prop121": "eb"
				},
				{
					"id": 2,
					"prop121": "ea"
				}
			]
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Updating nested collections (check all boxes and click Save)" class="interactive">
			<td mv-app mv-storage="#collection31">
				<div>
					<input type="checkbox" mv-storage="none" property="check1">
					<input type="checkbox" mv-storage="none" property="check2">
				</div>
				<ul>
					<h5 class="mv-group-heading"></h6>
					<li property="nestedCollection" mv-multiple mv-groupby="[if(check1,
						'-prop11')]">
						<div property="prop11"></div>
						<ul>
							<h6 class="mv-group-heading"></h6>
							<li property="prop12" mv-multiple mv-groupby="[if(check2,
								'+prop121')]">
								<div property="id"></div>
								<div property="prop121"></div>
							</li>
						</ul>
					</li>
				</ul>
			</td>
			<td>
				<div>
					<input type="checkbox">
					<input type="checkbox">
				</div>
				<ul>
					<h5>ab</h5>
					<li>
						<div>ab</div>
						<ul>
							<h6>ba</h6>
							<li>
								<div>0</div>
								<div>ba</div>
							</li>
							<li>
								<div>2</div>
								<div>ba</div>
							</li>
							<h6>bb</h6>
							<li>
								<div>1</div>
								<div>bb</div>
							</li>
						</ul>
					</li>
					<li>
						<div>ab</div>
						<ul>
							<h6>ea</h6>
							<li>
								<div>0</div>
								<div>ea</div>
							</li>
							<li>
								<div>2</div>
								<div>ea</div>
							</li>
							<h6>eb</h6>
							<li>
								<div>1</div>
								<div>eb</div>
							</li>
						</ul>
					</li>
					<h5>aa</h5>
					<li>
						<div>aa</div>
						<ul>
							<h6>ca</h6>
							<li>
								<div>1</div>
								<div>ca</div>
							</li>
							<h6>cb</h6>
							<li>
								<div>0</div>
								<div>cb</div>
							</li>
							<li>
								<div>2</div>
								<div>cb</div>
							</li>
						</ul>
					</li>
					<li>
						<div>aa</div>
						<ul>
							<h6>da</h6>
							<li>
								<div>0</div>
								<div>da</div>
							</li>
							<h6>db</h6>
							<li>
								<div>1</div>
								<div>db</div>
							</li>
							<li>
								<div>2</div>
								<div>db</div>
							</li>
						</ul>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection32">
{
	"deepGroup": [
		{
			"prop11": {
				"prop12": {
					"prop13": 1
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -2
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 2
				},
				"prop22": "cba"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": 0
				},
				"prop22": "abc"
			}
		},
		{
			"prop11": {
				"prop12": {
					"prop13": -1
				},
				"prop22": "abc"
			}
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Ungrouped collection and grouped collection referenced with
			mv-value (passing collection itself as argument)">
			<td mv-app mv-storage="#collection32">
				<ul>
					<li property="deepGroup" mv-multiple>
						<div property="prop11">
							<div property="prop12">
								<div property="prop13"></div>
							</div>
							<div property="prop22"></div>
						</div>
					</li>
				</ul>
				<ul>
					<li property="deepGroup2" mv-multiple mv-value="groupBy(deepGroup,
						prop22)">
						<div property="id"></div>
						<div property="items" mv-multiple>
							<div property="prop11">
								<div property="prop12">
									<div property="prop13"></div>
								</div>
								<div>[prop22]</div>
							</div>
						</div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<li>
						<div>
							<div>
								<div>1</div>
							</div>
							<div>cba</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-2</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>2</div>
							</div>
							<div>cba</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>0</div>
							</div>
							<div>abc</div>
						</div>
					</li>
					<li>
						<div>
							<div>
								<div>-1</div>
							</div>
							<div>abc</div>
						</div>
					</li>
				</ul>
				<ul>
					<li>
						<div>cba</div>
						<div>
							<div>
								<div>
									<div>1</div>
								</div>
								<div>cba</div>
							</div>
						</div>
						<div>
							<div>
								<div>
									<div>2</div>
								</div>
								<div>cba</div>
							</div>
						</div>
					</li>
					<li>
						<div>abc</div>
						<div>
							<div>
								<div>
									<div>-2</div>
								</div>
								<div>abc</div>
							</div>
						</div>
						<div>
							<div>
								<div>
									<div>0</div>
								</div>
								<div>abc</div>
							</div>
						</div>
						<div>
							<div>
								<div>
									<div>-1</div>
								</div>
								<div>abc</div>
							</div>
						</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection33">
{
	"deepGroup": [
		{
			"prop11": {
				"prop22": "cba"
			},
			"prop12": 0
		},
		{
			"prop11": {
				"prop22": "abc"
			},
			"prop12": 1
		},
		{
			"prop11": {
				"prop22": "cba"
			},
			"prop12": 2
		},
		{
			"prop11": {
				"prop22": "abc"
			},
			"prop12": 3
		},
		{
			"prop11": {
				"prop22": "abc"
			},
			"prop12": 4
		}
	]
}
				</pre>
			</td>
			<td>
				<script>document.write($$("td pre").pop().outerHTML)</script>
			</td>
		</tr>
		<tr title="Referencing property with mv-path">
			<td mv-app mv-storage="#collection33">
				<ul>
					<b class="mv-group-heading"></b>
					<li property="deepGroup" mv-multiple mv-groupby="+prop11">
						<div property="prop12"></div>
						<div property="prop11" mv-path="prop22"></div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<b>abc</b>
					<li>
						<div>1</div>
						<div>abc</div>
					</li>
					<li>
						<div>3</div>
						<div>abc</div>
					</li>
					<li>
						<div>4</div>
						<div>abc</div>
					</li>
					<b>cba</b>
					<li>
						<div>0</div>
						<div>cba</div>
					</li>
					<li>
						<div>2</div>
						<div>cba</div>
					</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<pre id="collection34">
{
	"deepGroup": [
		{
			"prop11": {
				"prop22": "cba"
			},
			"prop12": 0
		},
		{
			"prop11": {
				"prop22": "abc"
			},
			"prop12": 1
		},
		{
			"prop11": {
				"prop22": "cba"
			},
			"prop12": 2
		},
		{
			"prop11": {
				"prop22": "abc"
			},
			"prop12": 3
		},
		{
			"prop11": {
				"prop22": "abc"
			},
			"prop12": 4
		}
	]
}
				</pre>
			</td>
			<td>
				<pre>
{
	"deepGroup": [
		{
			"prop12": 0,
			"newProp": {
				"prop22": "cba"
			}
		},
		{
			"prop12": 1,
			"newProp": {
				"prop22": "abc"
			}
		},
		{
			"prop12": 2,
			"newProp": {
				"prop22": "cba"
			}
		},
		{
			"prop12": 3,
			"newProp": {
				"prop22": "abc"
			}
		},
		{
			"prop12": 4,
			"newProp": {
				"prop22": "abc"
			}
		}
	]
}
				</pre>
			</td>
		</tr>
		<tr title="Referencing property with mv-alias and mv-path">
			<td mv-app mv-storage="#collection34">
				<ul>
					<b class="mv-group-heading"></b>
					<li property="deepGroup" mv-multiple mv-groupby="+newProp">
						<div property="prop12"></div>
						<div property="newProp" mv-alias="prop11" mv-path="prop22"></div>
					</li>
				</ul>
			</td>
			<td>
				<ul>
					<b>abc</b>
					<li>
						<div>1</div>
						<div>abc</div>
					</li>
					<li>
						<div>3</div>
						<div>abc</div>
					</li>
					<li>
						<div>4</div>
						<div>abc</div>
					</li>
					<b>cba</b>
					<li>
						<div>0</div>
						<div>cba</div>
					</li>
					<li>
						<div>2</div>
						<div>cba</div>
					</li>
				</ul>
			</td>
		</tr>
	</table>
</section>

<script src="mavo-sort.js"></script>

<script src="https://test.mavo.io/test.js"></script>
<script>
	document.getElementById("checkAndSave").addEventListener("click",
			function(e) {
				$$("input[type='checkbox']").forEach(function(box) {
					box.click();
				});
				$$(".mv-bar .mv-save").forEach(function(save) {
					save.click();
				});
			});
</script>
<script>
function getObjectArrayString(a) {
	s = '[\n';
	s += a.map((val) => {
		return JSON.stringify(val, null, ' ');
	}).join(',\n');
	s += '\n]';
	return s;
}
function ev(s) {
	return eval("(" + s + ")");
}
function expressionEvaluation(test, result, expected) {
  try {
    var r = (new Mavo.Expression(test.textContent)).eval({});
		if (r instanceof Array && r.length > 0 && typeof r[0] == 'object') {
			if (!(expected.childNodes.length > 0 && expected.childNodes[0].tagName)) {
				var expectedTextContent = expected.textContent;
				var code1 = document.createElement('code');
				var code2 = document.createElement('code');
				result.innerHTML = '';
				expected.innerHTML = '';
				result = result.appendChild(code1);
				expected = expected.appendChild(code2);

				result.textContent = getObjectArrayString(r);
				expected.textContent = getObjectArrayString(ev(expectedTextContent));
			}

			var e_r = ev(expected.textContent);
			return Test.equals(JSON.stringify(r, Object.keys(r).sort()),
			                   JSON.stringify(e_r, Object.keys(e_r).sort()));
		} else {
			function undefinedString(k, v) {
				if (v === undefined) {
					return "undefined";
				}
				return v;
			}
			result.textContent = JSON.stringify(r, undefinedString, 2);
			expected.textContent = JSON.stringify(ev(expected.textContent),
					undefinedString, 2);
			var exVal = ev(expected.textContent);
			var acVal = ev(result.textContent);
			if (exVal instanceof Object && acVal instanceof Object) {
				exVal = JSON.stringify(exVal, Object.keys(exVal).sort());
				acVal = JSON.stringify(acVal, Object.keys(acVal).sort());
			}
			return Test.equals(exVal, acVal);
		}
  }
  catch(e) {
    console.error(e);
    result.textContent = "ERROR";
    return false;
  }
}
function selectMenuContent(td, ref) {
	var elements = $$("*", td);

	return $$("*", ref).every((refElement, i) => {
		var element = elements[i];

		var pass = element.nodeName == refElement.nodeName;
		if (element.nodeName !== "SELECT") {
			pass = pass & Test.content(element).trim() ==
				Test.content(refElement).trim();
		}

		return pass;
	});
}
</script>
</body>
</html>

